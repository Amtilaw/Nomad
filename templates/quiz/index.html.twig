{% extends 'base.html.twig' %}

{% block title %}Hello HomeController!{% endblock %}

{% block baseStylesheets %}
    <link rel="stylesheet" href="{{ asset('bower_components/select2/dist/css/select2.min.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/css/customizedStyle.css') }}">
{% endblock %}


{% block body %}

    <div id="page_content" class="height-700">

        <div id="page_content_inner" class="height-700">

            <div class="md-card height-700">
                <div class="uk-grid uk-grid uk-grid-collapse uk-grid-divider uk-flex" data-uk-grid-match>
                    
                    <div class="uk-width-large-1-6 uk-width-medium-1-3 js_collapsible_column height-700">
                        
                        <div class="md-card-toolbar {{pageColor}}">
                            <div class="md-card-toolbar-actions uk-hidden-small">
                                {# <i class="md-icon material-icons js_hidden">&#xE5D5;</i> #}
                                <a href="#" data-column-toggle>
                                    <i class="md-icon material-icons" title="Collapse">format_indent_decrease</i>
                                    <i class="md-icon material-icons" style="display: none" title="Expand">format_indent_increase</i>
                                </a>
                            </div>
                            <h1 class="md-card-toolbar-heading-text js_hidden uk-text-overflow pageTitle">
                                <i class="material-icons">{{pageIcon}}</i></span>
                                <span>{{pageTitle}}</span>
                            </h1>
                        </div>

                        {# menu contextuel #}
                        {% include rootTemplate ~ '/component/contextual_menu.html.twig' %}
                        
                    </div>
                    
                    <div class="uk-flex-item-1">
                        
                        {# nav bar contextuel #}
                        {% include rootTemplate ~ '/component/contextual_secondary_nav.html.twig' %}
                        
                        <div class="md-card-content mostly-customized-scrollbar mainScroll">


                            <!-- Tabs content -->
                            <div
                                    class="tab-pane fade show active"
                                    id="ex1-tabs-1"
                                    role="tabpanel"
                                    aria-labelledby="ex1-tab-1"
                            >
                                <div class="pt-15 pb-15 pl-3 borderBottom height50">
                                    <div id="player" style="width:500px;height:281px"></div>
                                </div>
                                <div class="pt-2 pb-2">
                                        <div class="uk-form-row">

                                            <div class="md-card-content">
                                                <div class="uk-grid">
                                                    <div class="uk-width-1-1" id="questionSet1" hidden>
                                                        <ul class="uk-tab" id="tabs_1_content" class="uk-switcher uk-margin">
                                                            <li>
                                                                <div class="uk-form-label data-uk-grid-margin" id="question1-1" hidden>
                                                                    <div class="uk-form-label">Question n°1</div>
                                                                    <div class="uk-form-controls">
                                                                        <label><input class="uk-radio" type="radio" name="reponse" id="1-1"> A</label><br>
                                                                        <label><input class="uk-radio" type="radio" name="reponse" id="1-2"> B</label><br>
                                                                        <label><input class="uk-radio" type="radio" name="reponse" id="1-3"> C</label><br>
                                                                        <label><input class="uk-radio" type="radio" name="reponse" id="1-4"> D</label><br>

                                                                        <button type="button" class="md-btn md-btn-primary submitbTN" onclick="nextQuestion()">SUIVANT</button>
                                                                        <button type="button" class="md-btn md-btn-default cancelBtn" onclick="previousQuestion()">RETOUR</button>
                                                                    </div>
                                                                </div>
                                                                <div class="uk-form-label data-uk-grid-margin" id="question1-2" hidden>
                                                                    <div class="uk-form-label">Question n°2</div>
                                                                    <div class="uk-form-controls">
                                                                        <label><input class="uk-radio" type="radio" name="reponse2" id="2-1"> A</label><br>
                                                                        <label><input class="uk-radio" type="radio" name="reponse2" id="2-2"> B</label><br>
                                                                        <label><input class="uk-radio" type="radio" name="reponse2" id="2-3"> C</label><br>

                                                                        <button type="button" class="md-btn md-btn-primary submitbTN" onclick="nextQuestion()">SUIVANT</button>
                                                                        <button type="button" class="md-btn md-btn-default cancelBtn" onclick="previousQuestion()">RETOUR</button>
                                                                    </div>
                                                                </div>
                                                                <div class="uk-form-label data-uk-grid-margin" id="question1-3" hidden>
                                                                    <div class="uk-form-label">Question n°3</div>
                                                                    <div class="uk-form-controls">
                                                                        <label><input class="uk-radio" type="checkbox" name="reponse3" id="3-1"> A</label><br>
                                                                        <label><input class="uk-radio" type="checkbox" name="reponse3" id="3-2"> B</label><br>
                                                                        <label><input class="uk-radio" type="checkbox" name="reponse3" id="3-3"> C</label><br>
                                                                        <label><input class="uk-radio" type="checkbox" name="reponse3" id="3-4"> D</label><br>

                                                                        <button type="button" class="md-btn md-btn-primary submitbTN" onclick="nextQuestion()">SUIVANT</button>
                                                                        <button type="button" class="md-btn md-btn-default cancelBtn" onclick="previousQuestion()">RETOUR</button>
                                                                    </div>
                                                                </div>
                                                                <div class="uk-form-label data-uk-grid-margin" id="question1-4" hidden>
                                                                    <div class="uk-form-label">Question n°4</div>
                                                                    <div class="uk-form-controls">
                                                                        <textarea class="uk-textarea" rows="5" placeholder="Entrer réponse"></textarea>

                                                                        <button type="button" class="md-btn md-btn-primary submitbTN" onclick="nextQuestion()">SUIVANT</button>
                                                                        <button type="button" class="md-btn md-btn-default cancelBtn" onclick="previousQuestion()">RETOUR</button>
                                                                    </div>
                                                                </div>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                    <div class="uk-width-1-1" id="questionSet2" hidden>
                                                        <ul class="uk-tab" id="tabs_1_content" class="uk-switcher uk-margin">
                                                            <li>
                                                                <div class="uk-form-label data-uk-grid-margin" id="question2-1" hidden>
                                                                    <div class="uk-form-label">Question n°1</div>
                                                                    <div class="uk-form-controls">
                                                                        <label><input class="uk-radio" type="radio" name="reponse1" id="2-1"> A</label><br>
                                                                        <label><input class="uk-radio" type="radio" name="reponse1" id="2-2"> B</label><br>
                                                                        <label><input class="uk-radio" type="radio" name="reponse1" id="2-3"> C</label><br>

                                                                        <button type="button" class="md-btn md-btn-primary submitbTN" onclick="nextQuestion()">SUIVANT</button>
                                                                        <button type="button" class="md-btn md-btn-default cancelBtn" onclick="previousQuestion()">RETOUR</button>
                                                                    </div>
                                                                </div>
                                                                <div class="uk-form-label data-uk-grid-margin" id="question2-2" hidden>
                                                                    <div class="uk-form-label">Question n°2</div>
                                                                    <div class="uk-form-controls">
                                                                        <textarea class="uk-textarea" rows="5" placeholder="Entrer réponse"></textarea>

                                                                        <button type="button" class="md-btn md-btn-primary submitbTN" onclick="nextQuestion()">SUIVANT</button>
                                                                        <button type="button" class="md-btn md-btn-default cancelBtn" onclick="previousQuestion()">RETOUR</button>
                                                                    </div>
                                                                </div>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                    <div class="uk-width-1-1" id="questionSet3" hidden>
                                                        <ul class="uk-tab" id="tabs_1_content" class="uk-switcher uk-margin">
                                                            <li>
                                                                <div class="uk-form-label data-uk-grid-margin" id="question3-1" hidden>
                                                                    <div class="uk-form-label">Question n°1</div>
                                                                    <div class="uk-form-controls">
                                                                        <label><input class="uk-radio" type="radio" name="reponse1" id="3-1"> A</label><br>
                                                                        <label><input class="uk-radio" type="radio" name="reponse1" id="3-2"> B</label><br>
                                                                        <label><input class="uk-radio" type="radio" name="reponse1" id="3-3"> C</label><br>

                                                                        <button type="button" class="md-btn md-btn-primary submitbTN" onclick="nextQuestion()">SUIVANT</button>
                                                                        <button type="button" class="md-btn md-btn-default cancelBtn" onclick="previousQuestion()">RETOUR</button>
                                                                    </div>
                                                                </div>
                                                                <div class="uk-form-label data-uk-grid-margin" id="question3-2" hidden>
                                                                    <div class="uk-form-label">Question n°2</div>
                                                                    <div class="uk-form-controls">
                                                                        <textarea class="uk-textarea" rows="5" placeholder="Entrer réponse"></textarea>

                                                                        <button type="button" class="md-btn md-btn-primary submitbTN" onclick="nextQuestion()">SUIVANT</button>
                                                                        <button type="button" class="md-btn md-btn-default cancelBtn" onclick="previousQuestion()">RETOUR</button>
                                                                    </div>
                                                                </div>
                                                                <div class="uk-form-label data-uk-grid-margin" id="question3-3" hidden>
                                                                    <div class="uk-form-label">Question n°3</div>
                                                                    <div class="uk-form-controls">
                                                                        <label><input class="uk-radio" type="radio" name="reponse1" id="3-1"> A</label><br>
                                                                        <label><input class="uk-radio" type="radio" name="reponse1" id="3-2"> B</label><br>

                                                                        <button type="button" class="md-btn md-btn-primary submitbTN" onclick="nextQuestion()">SUIVANT</button>
                                                                        <button type="button" class="md-btn md-btn-default cancelBtn" onclick="previousQuestion()">RETOUR</button>
                                                                    </div>
                                                                </div>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </form>                                    
                                </div>
                            </div>
                            <!-- Tabs content -->

                        </div>

                    </div>
                    
                    <div class="uk-width-large-1-5 uk-width-medium-1-3 js_collapsible_column collapsed">
                        
                        <div class="md-card-toolbar md-bg-grey-100">
                            <div class="md-card-toolbar-actions uk-hidden-small">
                                <a href="#" data-column-toggle>
                                    <i class="md-icon material-icons" title="Collapse">format_indent_increase</i>
                                    <i class="md-icon material-icons" style="display: none"
                                        title="Expand">format_indent_decrease</i>
                                </a>
                            </div>
                            <h3 class="md-card-toolbar-heading-text js_hidden">
                                Filtres
                            </h3>
                        </div>
                        
                        {# Filters #}
                        {% include rootTemplate ~ '/component/contextual_filters.html.twig' %}
                        
                    </div>

                </div>
            </div>

        </div>

    </div>
    
{% endblock %}

{% block baseJavascripts %}

    <script src="{{ asset('bower_components/jquery-ui/jquery-ui.min.js') }}"></script>

    <!-- ionrangeslider -->
    <script src="{{asset('bower_components/ion.rangeslider/js/ion.rangeSlider.min.js')}}"></script>
    <script src="{{asset('bower_components/select2/dist/js/select2.min.js')}}"></script>
    <script src="{{ asset('assets/js/prisesNeuves.js') }}"></script>

    <script src="{{asset('assets/js/playerjs.js')}}" type="text/javascript"></script>
    <script>

        //initialisation des paliers
        let palliers = [3, 7, 8];

        //compteur du prochain pallier
        let count = 0;
        var player = new Playerjs({id:"player", file:"{{ asset('assets/video.mp4') }}"});

        let quizzDone = true;

        let questionCount = 1;
        let questionSetCount = 1;

        // Cette variable stocke le temp de la vidéo avant n-1 checkPalier()
        let temp = player.api("time");
        
        player.api("play");
        function PlayerjsEvents(event,id,data){
        if(event=="play" && quizzDone == false){
            player.api("pause");
        }

        }

        checkPalier();

        // Check si la vidéo à attein le premier pallier
        function checkPalier(){
            isUserForwardVideo();
            if (player.api("time") > palliers[count]){
            console.log(player.api("time"));
            console.log("Pallier "+ count + " !");
            quizzDone = false;
            quizzIsDone();
            count++;
            
            if (palliers.length <= count)
            return 0;
        }   
            setTimeout(() => { checkPalier(); }, 1000);
        }

        // verifie si l'utilisateur a avancé dans la vidéo return true si oui
        function isUserForwardVideo(){
            // renvoie true si l'utilisateur à avancé de plus de 1 secondes dans la vidéo
            if (player.api("time") - temp > 3){
                    console.log("Vous ne pouvez pas avancer dans la vidéo");
                    player.api("seek",""+temp);
                    return true;
                }
                else {
                    temp = player.api("time");
                    return false;
                }
        }

        function quizzIsDone(){
            if (document.getElementById('question'+questionSetCount+'-'+questionCount) === null){
                quizzDone = true;
                document.getElementById('questionSet'+questionSetCount).hidden = true;
                questionSetCount++;
                questionCount=1;
                player.api("play");
                this.innerHTML="<p>Questionnaire réussi</p>";
            }
            else {
                player.api("pause");
                document.getElementById('questionSet'+questionSetCount).hidden = false;
                document.getElementById('question'+questionSetCount+'-'+questionCount).hidden = false;
            }
        }

        function previousQuestion(){
            if(questionCount > 1){
                document.getElementById('question'+questionSetCount+'-'+questionCount).hidden = true;
                questionCount--;
                quizzIsDone();
            }
        }
 
        function nextQuestion(){
            document.getElementById('question'+questionSetCount+'-'+questionCount).hidden = true;
            questionCount++;
            quizzIsDone();
        }
        
        </script>

{% endblock %}
